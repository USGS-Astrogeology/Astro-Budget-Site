{"draw":0,"recordsTotal":{{ tasks|length }},"recordsFiltered":{{ tasks|length }},"data":[
{% for task in tasks %}
  {% set current_staff = task.staffing[0].peopleid %}
  {% set cost_total = 0 %}
  { "Task": "{{task.taskname}}", "taskid": {{ task.taskid }},
    "Staffing": 
    {% if task.staffing %}
      {{ task.staffing[0].peopleid }},
    {% else %}
      "None",
    {% endif %}

  {% for staff in task.staffing %}
    {% if staff.peopleid != current_staff%}
      "Cost": "{{ cost_total|currencyformat }}"}, { "Task": "{{ task.taskname }}",
      "taskid": {{ task.taskid }}, 
      "Staffing": {{ staff.peopleid }},
      {% set current_staff = staff.peopleid %}
      {% set cost_total = 0 %}
    {% endif %}
    "{{ staff.fiscalyear }}staffingid": {{ staff.staffingid }},
    "{{ staff.fiscalyear }}": {{ staff.q1hours + staff.q2hours + staff.q3hours + staff.q4hours + staff.flexhours }},
    {% if staff.person.effective_salary %}
      {% set cost_total = cost_total + ((staff.person.effective_salary.estsalary * staff.person.effective_salary.laf) + (staff.person.effective_salary.estbenefits * staff.person.effective_salary.laf)) %}
    {% endif %}
    {% if loop.last %}
      "Cost": "{{ cost_total|currencyformat }}"}
    {% endif %}
  {% endfor %}{% if not loop.last %},{% endif %}
{% endfor %}
]}
