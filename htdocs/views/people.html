<!DOCTYPE html>
<html>
    <head>
        <title>Proposal Budget People Listing</title>
        {% include 'menu-header.html' %}
    </head>
    {% for error in debug %}
      <pre>error.msg</pre>
    {% endfor %}
    <body>
        {% include 'menu-tags.html' %}
      <div class="container">
        <div id="title">
          <h2>List of People
          <a href='javascript:void(0)' onClick="editUserDialog('new')" id='newButton'>New</a></h2>
        </div>
        <div id="warningDiv" class="ui-corner-all ui-state-highlight" style="width=100px;align=right;"></div>
        <div id="editDialog" class="ui-widget"></div>
        <table id="peopleTable" class="display" cellspacing="0" width="100%">
          <thead><tr><th>Name</th><th>Title</th><th>Pay Plan</th><th>Username</th></tr></thead>
        </table>
      </div>

      <script type="text/javascript" charset="utf-8">
        function editUserDialog(peopleid) {
          $("#editDialog").load("index.php?view=people-edit&peopleid=" + peopleid);

          dialog = $("#editDialog").dialog({
            autoOpen: false,
            height: 600,
            width: 1000,
            modal: true,
            buttons: {
              "Save User": saveUser,
              Cancel: function () {
                dialog.dialog("close");
              }
            }
          });

          dialog.dialog("open");
        
        }

        function saveUser() {
          $.post("index.php", $("#peopleForm").serialize());
          // var table = $("#peopleData").DataTable( {
          //   "ajax": "index.php?view=people-list-json"
          // });

          // table.ajax.reload();

          $('#peopleTable').dataTable().fnDestroy();
          $('#peopleTable').dataTable( {
            "processing": true,
            "serverSide": false,
            "ajax": "index.php?view=people-list-json",
            "lengthMenu": [[20, 50, 100, -1], [20, 50, 100, "All"]]
          } );

          dialog.dialog("close");
          $("#warningDiv").html("<p>Updated [" + $("#peopleid").val() + "] " + $("#name").val() + 
                                " (" + $("#username").val() +")</p>");
          $("#warningDiv").show();
        }

        $(document).ready(function() {
          $("#newButton").button();
          $("#warningDiv").hide();
          $('#peopleTable').dataTable( {
            "processing": true,
            "serverSide": false,
            "ajax": "index.php?view=people-list-json",
            "lengthMenu": [[20, 50, 100, -1], [20, 50, 100, "All"]]
          } );
        } );
      </script>
    </body>
</html>
