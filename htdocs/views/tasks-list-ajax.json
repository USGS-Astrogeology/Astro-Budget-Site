{"draw":0,"recordsTotal":{{ tasks|length }},"recordsFiltered":{{ tasks|length }},"data":[
{% for task in proposals[0].tasks %}
  {% if task.staffing is empty %}
     {% if (remote_user[0].admin == 't') or (remote_user[0].peopleid == proposals[0].peopleid) %}
["<a href='javascript:void(0)' onclick=\"staffingEdit({{ task.taskid }}, 'new')\">{{ task.taskname }}</a>",
     {% else %}
["{{ task.taskname }}",
     {% endif %}
"N/A", 0, "$0.00", "", ""]
  {% endif %}

  {% set current_staff = task.staffing[0].peopleid %}
  {% set cost_total = 0 %}
  { "Task": "{{task.taskname}}", "taskid": {{ task.taskid }},
  "Staffing": {{ task.staffing[0].peopleid }},

  {% for staff in task.staffing %}
    {% if staff.peopleid != current_staff%}
      "Cost": "${{ cost_total|number_format(2,'.',',') }}"}, { "Task": "{{ task.taskname }}",
      "taskid": {{ task.taskid }}, "Staffing": {{ staff.peopleid }},
      {% set current_staff = staff.peopleid %}
      {% set cost_total = 0 %}
    {% endif %}
    "{{staff.FY}}staffingid": {{ staff.staffingid }},
    "{{staff.FY}}": {{ staff.q1hours + staff.q2hours + staff.q3hours + staff.q4hours + staff.flexhours }},
    {% set cost_total = cost_total + staff.staffcosts%}
    {% if loop.last %}
      "Cost": "${{ cost_total|number_format(2,'.',',') }}"}
    {% endif %}
  {% endfor %}{% if not loop.last %},{% endif %}
{% endfor %}
]}
